# [笔记目录](目录.md)
# 数据清洗部分
通常情况下，我们爬取到的数据总是很"脏"。也许是不符合我们的要求，也许是格式不统一，也许是命名混乱。为了让后续的处理更为方便，所以需要数据先进行清洗
## 1.数据整理
### 1.1 将图片文件格式统一
```python
import os
import cv2

def listfiles(rootDir,mode,start=1):
    if mode not in (0,1,2):
        return "模式有误"
    mods = {0: ".jpg",1:".png",2:".tif"}
    mod = mods[mode]
    
    list_dirs = os.walk(rootDir)  #嵌套的访问文件夹下的所有文件
    n = start 
    for root, dirs, files in list_dirs:  # 遍历文件夹下的图片
        for d in dirs:
            print((os.path.join(root, d)))
        for f in files:
            fileid = n  # 获得图片的名字，不含后缀
            filepath = os.path.join(root, f) 
            try:
                src = cv2.imread(filepath, 1)  # 读取原始图片，数据会加载到内存中
                print("src=", filepath, src.shape)
                os.remove(filepath) # 移除原来的图片
                cv2.imwrite(os.path.join(root, str(fileid) + mod), src)  # 保存经过格式转换的图片
            except:
                os.remove(filepath)
                continue
            n+=1 

path = "D:\spider\Image-Downloader-master\Image-Downloader-master\download_images\smile_face"  # 输入图片路径即可，可以在这个文件夹下放置各种后缀名的图片，代码会将所有图片统一成 jpg 格式
mode = {0: ".jpg",1:".png",2:".tif"}
listfiles(path,1,5)
```
![Alt text](data/数据清洗/data_1.png)

### 1.2  人脸检测

```python
# coding:utf8
import cv2
import dlib
import numpy as np
import sys
import os
import matplotlib.pyplot as plt

# 人脸检测的接口，这个是 OpenCV 中自带的
cascade_path = './Emotion_Recognition_File/face_detect_model/haarcascade_frontalface_default.xml'
cascade = cv2.CascadeClassifier(cascade_path)

img_path = "./Emotion_Recognition_File/face_det_img/" # 测试图片路径
images = os.listdir(img_path)
for image in images:
    im = cv2.imread(os.path.join(img_path, image), 1) # 读取图片
    rects = cascade.detectMultiScale(im, 1.3, 5)  # 人脸检测函数
    print("检测到人脸的数量", len(rects))
    if len(rects) == 0:  # len(rects) 是检测人脸的数量，如果没有检测到人脸的话，会显示出图片，适合本地调试使用，在服务器上可能不会显示
#         cv2.namedWindow('Result', 0)
#         cv2.imshow('Result', im)
#         print("没有检测到人脸")
        pass
    plt.imshow(im[:, :, ::-1])  # 显示
    plt.show()
#         os.remove(os.path.join(img_path, image)) # 
#         k = cv2.waitKey(0)
#         if k == ord('q'): # 在英文状态下，按下按键 q 会关闭显示窗口    
#             break
#     print()
# cv2.destroyAllWindows()   
```
____
返回目录
[返回深度学习部分](深度学习.md/#返回坐标)

